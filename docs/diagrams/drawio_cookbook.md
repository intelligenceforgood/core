# Draw.io Diagram Cookbook

This guide explains how to convert rough technical drafts into polished, professional diagrams for our public documentation. It assumes no prior experience with draw.io.

## 1. Draft the Structure (with Copilot)
Draw.io cannot import ASCII art directly. We use **Mermaid** as the bridge format.

*   **If starting from scratch**: Ask Copilot: *"Generate a Mermaid sequence diagram showing the user login flow."*
*   **If you have an ASCII chart**: Ask Copilot: *"Convert this ASCII chart into valid Mermaid syntax."*
*   **Action**: Copy the code block (it usually starts with `graph TD` or `sequenceDiagram`).

## 2. Import into draw.io
We use [diagrams.net](https://app.diagrams.net/) (formerly draw.io).

### Option A: Importing Mermaid Code (Recommended)
1.  Open a blank diagram in draw.io.
2.  In the top menu, go to **Arrange** > **Insert** > **Advanced** > **Mermaid**.
3.  Paste your Mermaid code into the text box.
4.  Click **Insert**.
    *   *Result*: You will see a basic, unstyled diagram. This is your skeleton.

### Option B: Importing an Existing SVG
Use this if you have a diagram generated by another tool (like a generated Terraform graph) that needs cleanup.
1.  Go to **File** > **Import from** > **Device...**.
2.  Select the `.svg` file from your computer.
    *   *Why do this?* Raw generated diagrams often have tiny fonts or messy layouts. Importing them lets you apply our "House Style" (GCP icons, readable fonts) without redrawing everything from scratch.

## 3. Apply the "House Style"
We want diagrams to look consistent and professional, not like default engineering schematics.

### Setup
1.  **Enable Grid**: Ensure **View** > **Grid** is checked.
2.  **Load GCP Icons**:
    *   Click **More Shapes...** (bottom left of the sidebar).
    *   Scroll down to the **Networking** or **Cloud** section.
    *   Check **Google Cloud Platform**.
    *   Click **Apply**.

### Styling Rules
1.  **Replace Generic Shapes**:
    *   Delete the generic square boxes from the import.
    *   Drag in official icons from the **Google Cloud Platform** library on the left (e.g., search for "Cloud Run", "Firestore", "Pub/Sub").
2.  **Connectors (Arrows)**:
    *   Select an arrow. In the right-hand **Style** panel:
        *   **Waypoints**: Choose **Orthogonal** (right-angle bends) or **Curved**. Avoid the default "Straight" lines if they cut through other shapes.
        *   **Width**: Set to **2pt** (default is often 1pt and too thin).
3.  **Text & Labels**:
    *   **Font**: Helvetica or Arial.
    *   **Size**: Minimum **12pt** for labels, **14pt+** for headers.
    *   **Placement**: Keep labels close to their icons.
4.  **Grouping**:
    *   To show a VPC, Region, or Project, use a **Container**.
    *   Search for "Rectangle" in the General library.
    *   Set **Fill** to `#f5f5f5` (very light grey) and **Line** to Dashed.
    *   Send it to the back (**Arrange** > **To Back**) so icons sit on top.

## 4. Save and Export

### Step A: Save Source (For Collaboration)
Always save the editable version.
1.  **File** > **Save as...** > **XML File (.drawio)**.
2.  **Primary Location**: Save to the shared Google Drive folder `i4g-docs-diagrams` (create if it doesn't exist). This allows non-engineers to edit it later.
3.  **Repo Backup**: Save a copy to `core/docs/diagrams/<area>/<filename>.drawio`.

### Step B: Export Asset (For Publishing)
1.  Go to **File** > **Export as** > **SVG...**.
2.  **Configure Settings**:
    *   **Zoom**: 100%
    *   **Border Width**: 0
    *   **Transparent Background**: **CHECKED** (Required for dark mode compatibility).
    *   **Embed Fonts**: **CHECKED** (Prevents text from breaking on different computers).
    *   **Include a copy of my diagram**: Unchecked (keeps file size smaller).
3.  Click **Export**.
4.  **Save Location**: `docs/book/assets/<area>/<filename>.svg` (in the `docs` repo).
    *   **Important**: Always use the structured `docs/book/assets/` folder (e.g., `architecture/`, `screenshots/`). Do **not** use `.gitbook/assets` (GitBook's default upload folder).

## 5. Embed in Documentation
GitBook and Markdown render SVGs well, but large diagrams can be hard to read. Always provide a zoom link.

**Markdown Snippet:**
```markdown
![Description of the diagram](../assets/architecture/my-diagram.svg)
[Open full size](../assets/architecture/my-diagram.svg)
```

## Checklist
Before committing, check:
- [ ] Did you use official GCP icons instead of generic boxes?
- [ ] Is the text size at least 12pt?
- [ ] Is the background transparent?
- [ ] Did you save the `.drawio` source file?
- [ ] Does the Markdown include the "Open full size" link?
